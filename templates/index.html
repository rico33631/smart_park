<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <h1>Smart Parking</h1>
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" data-view="operator">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="9" y1="9" x2="15" y2="9"/>
                        <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    Operator Dashboard
                </button>
                <button class="nav-btn" data-view="booking">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Book Parking
                </button>
                <button class="nav-btn" data-view="bookings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    View Bookings
                </button>
            </div>
            <div class="nav-status">
                <span class="status-dot"></span>
                <span id="lastUpdate">Updating...</span>
            </div>
        </div>
    </nav>

    <!-- Operator Dashboard View -->
    <div class="view-container" id="operator-view">
        <div class="container">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card available">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Available Spaces</div>
                        <div class="stat-value" id="availableSpaces">-</div>
                    </div>
                </div>
                <div class="stat-card occupied">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Occupied Spaces</div>
                        <div class="stat-value" id="occupiedSpaces">-</div>
                    </div>
                </div>
                <div class="stat-card total">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <path d="M3 9h18M9 21V9"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Spaces</div>
                        <div class="stat-value" id="totalSpaces">-</div>
                    </div>
                </div>
                <div class="stat-card rate">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="12" y1="2" x2="12" y2="6"/>
                            <line x1="12" y1="18" x2="12" y2="22"/>
                            <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/>
                            <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/>
                            <line x1="2" y1="12" x2="6" y2="12"/>
                            <line x1="18" y1="12" x2="22" y2="12"/>
                            <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/>
                            <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Occupancy Rate</div>
                        <div class="stat-value" id="occupancyRate">-</div>
                    </div>
                </div>
            </div>

            <!-- Parking Grid Section -->
            <div class="section">
                <div class="section-header">
                    <h2>Parking Lot Layout</h2>
                    <div class="section-actions">
                        <button class="btn btn-secondary" onclick="refreshParkingStatus()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div id="parkingGrid" class="parking-grid"></div>
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-dot available"></span>
                        <span>Available</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot occupied"></span>
                        <span>Occupied</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot booked"></span>
                        <span>Booked</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Occupancy History (24h)</h3>
                    <canvas id="historyChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Occupancy Prediction (Next 6h)</h3>
                    <canvas id="predictionChart"></canvas>
                </div>
            </div>

            <!-- Recent Events & Daily Stats -->
            <div class="bottom-grid">
                <div class="section">
                    <h3>Recent Activity</h3>
                    <div id="recentEvents" class="events-list"></div>
                </div>
                <div class="section">
                    <h3>Today's Summary</h3>
                    <div class="daily-stats">
                        <div class="daily-stat">
                            <div class="label">Entries</div>
                            <div class="value" id="todayEntries">-</div>
                        </div>
                        <div class="daily-stat">
                            <div class="label">Exits</div>
                            <div class="value" id="todayExits">-</div>
                        </div>
                        <div class="daily-stat">
                            <div class="label">Avg Occupancy</div>
                            <div class="value" id="todayAvgOccupancy">-</div>
                        </div>
                        <div class="daily-stat">
                            <div class="label">Peak Occupancy</div>
                            <div class="value" id="todayPeakOccupancy">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking View -->
    <div class="view-container hidden" id="booking-view">
        <div class="container">
            <div class="booking-wizard">
                <h2>Book a Parking Space</h2>

                <!-- Step 1: Select Time -->
                <div class="booking-step active" id="step-time">
                    <h3>Step 1: Select Date & Time</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Start Date & Time</label>
                            <input type="datetime-local" id="bookingStartTime" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>End Date & Time</label>
                            <input type="datetime-local" id="bookingEndTime" class="form-control">
                        </div>
                    </div>
                    <div id="bookingCost" class="cost-display hidden">
                        <div class="cost-label">Estimated Cost:</div>
                        <div class="cost-value" id="estimatedCost">$0.00</div>
                        <div class="cost-details" id="costDetails"></div>
                    </div>
                    <button class="btn btn-primary" onclick="searchAvailableSpots()">Search Available Spaces</button>
                </div>

                <!-- Step 2: Select Space -->
                <div class="booking-step hidden" id="step-space">
                    <h3>Step 2: Choose Your Space</h3>
                    <div id="availableSpaces" class="available-spaces-grid"></div>
                    <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
                </div>

                <!-- Step 3: Customer Details -->
                <div class="booking-step hidden" id="step-details">
                    <h3>Step 3: Enter Your Details</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="customerName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="customerEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="customerPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Vehicle Number *</label>
                            <input type="text" id="vehicleNumber" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Vehicle Type</label>
                            <select id="vehicleType" class="form-control">
                                <option value="car">Car</option>
                                <option value="suv">SUV</option>
                                <option value="truck">Truck</option>
                                <option value="motorcycle">Motorcycle</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>Special Notes (Optional)</label>
                            <textarea id="bookingNotes" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="goToStep(2)">Back</button>
                        <button class="btn btn-primary" onclick="proceedToPayment()">Proceed to Payment</button>
                    </div>
                </div>

                <!-- Step 4: Payment -->
                <div class="booking-step hidden" id="step-payment">
                    <h3>Step 4: Payment</h3>
                    <div class="booking-summary">
                        <h4>Booking Summary</h4>
                        <div class="summary-row">
                            <span>Space:</span>
                            <span id="summarySpace">-</span>
                        </div>
                        <div class="summary-row">
                            <span>Duration:</span>
                            <span id="summaryDuration">-</span>
                        </div>
                        <div class="summary-row">
                            <span>Date:</span>
                            <span id="summaryDate">-</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total Amount:</span>
                            <span id="summaryTotal">$0.00</span>
                        </div>
                    </div>
                    <div class="payment-method">
                        <label>Payment Method</label>
                        <select id="paymentMethod" class="form-control">
                            <option value="card">Credit/Debit Card</option>
                            <option value="cash">Cash on Arrival</option>
                            <option value="wallet">Digital Wallet</option>
                        </select>
                    </div>
                    <div class="demo-notice">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <p>This is a demo payment. No actual charges will be made.</p>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                        <button class="btn btn-success" onclick="completeBooking()">Complete Booking</button>
                    </div>
                </div>

                <!-- Success Message -->
                <div class="booking-step hidden" id="step-success">
                    <div class="success-message">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <h3>Booking Confirmed!</h3>
                        <p>Your parking space has been successfully booked.</p>
                        <div class="booking-reference">
                            <strong>Booking Reference:</strong>
                            <span id="bookingReference">-</span>
                        </div>
                        <p class="reference-note">Please save this reference number for your records.</p>
                        <button class="btn btn-primary" onclick="resetBookingForm()">Make Another Booking</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bookings List View -->
    <div class="view-container hidden" id="bookings-view">
        <div class="container">
            <div class="section">
                <div class="section-header">
                    <h2>All Bookings</h2>
                    <div class="section-actions">
                        <select id="bookingStatusFilter" class="form-control" onchange="filterBookings()">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadBookings()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div id="bookingsList" class="bookings-list"></div>
            </div>
        </div>
    </div>

    <!-- Modal for Space Details -->
    <div id="spaceModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="spaceDetails"></div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
